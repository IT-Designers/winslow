build_and_deploy:
  image: maven
  script:
    - mvn clean test verify package
    - awk -F"," '{ instructions += $4 + $5; covered += $5 } END { print covered, "/", instructions, " instructions covered"; print 100*covered/instructions, "% covered" }' target/site/jacoco/jacoco.csv
    - mv target/winslow*.jar .
    - mv target/site/jacoco coverage-report
  coverage: '/([\d]+\.[\d]+) % covered/'
  artifacts:
    name: winslow-$CI_COMMIT_SHORT_SHA
    paths:
     - winslow*.jar
     - coverage-report
