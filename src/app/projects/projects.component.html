<div>
  <h1>Projects</h1>

  <div class="flex-grow-row control-button-row">
    <div class="flex-grow"></div>
    <button class="create-button" mat-raised-button color="primary"
            (click)="createNewProject()">Create Project
    </button>
  </div>

  <div class="project-list-replacement">
    <i *ngIf="projects == null">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </i>
    <i *ngIf="projects != null && projects.length == 0">There are no projects yet yet</i>
  </div>


  <mat-expansion-panel *ngFor="let view of projects" (afterCollapse)="stopLoading(view)" (afterExpand)="startLoading(view)">

    <mat-expansion-panel-header>
      <span style="display: flex; align-items: center">
        <app-state-icon [state]="view.state" animation="true"></app-state-icon>
        {{view.project.name}}
      </span>
    </mat-expansion-panel-header>


      <mat-tab-group #tabs (focusChange)="focusChange($event, view)">

        <mat-tab label="Control">
          <div class="stage-control-item">
            <p>Overwrite stage execution order</p>
            <mat-select #stageSelection placeholder="Stage selection">

              <mat-option *ngFor="let stage of view.project.pipelineDefinition.stageDefinitions; index as i" value="{{i}}">{{stage.name}}</mat-option>
            </mat-select>
            <button mat-raised-button (click)="setNextStage(view.project, stageSelection.value)" color="primary">Set Next</button>
          </div>
          <mat-divider></mat-divider>
          <div  class="stage-control-item">
            <span>Pause further stage execution</span>
            <mat-slide-toggle [checked]="view.paused" (change)="updateRequestPause(view.project, $event.checked)"></mat-slide-toggle>
          </div>
        </mat-tab>

        <mat-tab label="History">

          <i *ngIf="view.history == null">
            <mat-progress-bar mode="buffer"></mat-progress-bar>
          </i>

          <ng-container *ngIf="view.history != null">
            <i *ngIf="view.history.length == 0">This project has no history yet</i>
            <mat-list>
              <mat-list-item *ngFor="let entry of view.history" class="history-list-item">

                <app-state-icon [state]="entry.state"></app-state-icon>

                <p>{{toDate(entry.finishTime === null ? entry.startTime : entry.finishTime)}}</p>
                <p>{{entry.stageName}}</p>
              </mat-list-item>
            </mat-list>
          </ng-container>
        </mat-tab>

        <mat-tab label="Files">

        </mat-tab>

        <mat-tab label="Logs">

        </mat-tab>
      </mat-tab-group>

  </mat-expansion-panel>


</div>
