<div>
  <h1>Projects</h1>

  <div class="flex-grow-row control-button-row">
    <div class="flex-grow"></div>
    <button class="create-button" mat-raised-button color="primary"
            (click)="create()">Create Project
    </button>
  </div>

  <div class="project-list-replacement">
    <i *ngIf="projects == null">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    </i>
    <i *ngIf="projects != null && projects.length == 0">There are no projects yet yet</i>
  </div>


  <mat-expansion-panel *ngFor="let project of projects" (expandedChange)="maybeLoadHistory(project, $event)">


    <mat-expansion-panel-header>
      <span style="display: flex; align-items: center">
        <app-state-icon [state]="project.state" animation="true"></app-state-icon>
        {{project.name}}
      </span>
    </mat-expansion-panel-header>


    <i *ngIf="project.history == null">
      <mat-progress-bar mode="buffer"></mat-progress-bar>
    </i>

    <ng-container *ngIf="project.history != null">
      <h2>Control</h2>
      <form class="stage-control-item">
        <span>Next Stage to execute</span>
        <mat-form-field>
          <mat-select #stageSelection placeholder="Stage selection">
            <mat-option *ngFor="let stage of project.pipelineDefinition.stageDefinitions; index as i" value="{{i}}">{{stage.name}}</mat-option>
          </mat-select>
        </mat-form-field>
        <button mat-raised-button (click)="setNextStage(project, stageSelection.value)" color="primary">Execute</button>
      </form>

      <h2>History</h2>
      <i *ngIf="project.history.length == 0">This project has no history yet</i>
      <mat-list>
        <mat-list-item *ngFor="let entry of project.history" class="history-list-item">

          <app-state-icon [state]="entry.state"></app-state-icon>

          <p>{{toDate(entry.finishTime === null ? entry.startTime : entry.finishTime)}}</p>
          <p>{{entry.stageName}}</p>
        </mat-list-item>
      </mat-list>
    </ng-container>
  </mat-expansion-panel>


</div>
